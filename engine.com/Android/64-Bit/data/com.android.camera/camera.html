<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikasi Kamera React</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
</head>
<body class="bg-gray-900 text-white">
    <div id="root"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/17.0.2/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/17.0.2/umd/react-dom.production.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide-icons/0.2.3/index.umd.js"></script>
    
    <script>
        const { useState, useRef, useEffect } = React;
        const { Camera, Video, ZoomIn, ZoomOut, Download } = lucideIcons;

        const CameraApp = () => {
            const [mode, setMode] = useState('photo'); // photo, video, macro
            const [resolution, setResolution] = useState({ width: 3840, height: 2160, fps: 30 });
            const [zoom, setZoom] = useState(1);
            const [popupSettings, setPopupSettings] = useState({ open: false, type: null });
            const [isRecording, setIsRecording] = useState(false);
            const [recordedChunks, setRecordedChunks] = useState([]);
            const [capturedMedia, setCapturedMedia] = useState(null);

            const videoRef = useRef(null);
            const canvasRef = useRef(null);
            const mediaRecorderRef = useRef(null);
            const cameraModes = {
                photo: {
                    resolutions: [
                        { name: '4K', width: 3840, height: 2160, fps: 30 },
                        { name: '8K', width: 7680, height: 4320, fps: 30 }
                    ]
                },
                video: {
                    resolutions: [
                        { name: '4K 30fps', width: 3840, height: 2160, fps: 30 },
                        { name: '8K 60fps', width: 7680, height: 4320, fps: 60 }
                    ]
                },
                macro: {
                    resolutions: [
                        { name: '8K 30fps', width: 7680, height: 4320, fps: 30 }
                    ]
                }
            };

            const startCamera = async () => {
                try {
                    const constraints = {
                        video: { 
                            width: { ideal: resolution.width },
                            height: { ideal: resolution.height },
                            frameRate: { ideal: resolution.fps }
                        }
                    };
                    const stream = await navigator.mediaDevices.getUserMedia(constraints);
                    if (videoRef.current) {
                        videoRef.current.srcObject = stream;
                        if (mode === 'video') {
                            mediaRecorderRef.current = new MediaRecorder(stream);
                            mediaRecorderRef.current.ondataavailable = (event) => {
                                if (event.data.size > 0) {
                                    setRecordedChunks((prev) => prev.concat(event.data));
                                }
                            };
                            mediaRecorderRef.current.onstop = () => {
                                const blob = new Blob(recordedChunks, { type: 'video/webm' });
                                const videoURL = URL.createObjectURL(blob);
                                setCapturedMedia(videoURL);
                                setRecordedChunks([]);
                            };
                        }
                    }
                } catch (error) {
                    console.error('Error accessing camera:', error);
                    alert('Tidak dapat mengakses kamera. Pastikan Anda memberikan izin.');
                }
            };

            const captureMedia = () => {
                if (mode === 'photo') {
                    const canvas = canvasRef.current;
                    const video = videoRef.current;
                    if (canvas && video) {
                        const context = canvas.getContext('2d');
                        canvas.width = resolution.width;
                        canvas.height = resolution.height;
                        context.drawImage(video, 0, 0, resolution.width, resolution.height);
                        setCapturedMedia(canvas.toDataURL('image/jpeg'));
                    }
                } else if (mode === 'video') {
                    if (isRecording) {
                        mediaRecorderRef.current.stop();
                        setIsRecording(false);
                    } else {
                        mediaRecorderRef.current.start();
                        setIsRecording(true);
                    }
                }
            };

            useEffect(() => {
                startCamera();
            }, [mode, resolution]);

            const downloadMedia = () => {
                const link = document.createElement('a');
                link.href = capturedMedia;
                link.download = mode === 'photo' 
                    ? `photo_${resolution.width}x${resolution.height}.jpg` 
                    : `video_${resolution.width}x${resolution.height}_${resolution.fps}fps.webm`;
                link.click();
            };

            const handleZoom = (direction) => {
                const newZoom = direction === 'in' ? Math.min(zoom + 0.5, 10) : Math.max(zoom - 0.5, 1);
                setZoom(newZoom);
            };

            return (
                <div className="p-4 max-w-md mx-auto bg-black text-white min-h-screen relative">
                    <div className="rounded-[50px] overflow-hidden border-8 border-gray-700 relative">
                        <video 
                            ref={videoRef} 
                            autoPlay 
                            playsInline
                            className="w-full"
                            style={{ transform: `scale(${zoom})` }}
                        />
                    </div>

                    <div className="absolute top-4 right-4 flex flex-col space-y-2">
                        <button onClick={() => handleZoom('in')} className="bg-white/20 p-2 rounded-full"><ZoomIn /></button>
                        <button onClick={() => handleZoom('out')} className="bg-white/20 p-2 rounded-full"><ZoomOut /></button>
                    </div>

                    <div className="mt-4 flex space-x-4">
                        <button onClick={captureMedia} className={`flex-1 py-3 rounded-full flex items-center justify-center ${isRecording ? 'bg-red-500 text-white animate-pulse' : 'bg-white text-black'}`}>
                            {mode === 'photo' ? <Camera /> : <Video />}
                            <span>{mode === 'photo' ? 'Tangkap Foto' : (isRecording ? 'Berhenti Rekam' : 'Mulai Rekam')}</span>
                        </button>
                    </div>

                    {capturedMedia && (
                        <div className="mt-4 relative">
                            {mode === 'photo' ? (
                                <img src={capturedMedia} alt="Foto yang Ditangkap" className="w-full rounded-xl" />
                            ) : (
                                <video src={capturedMedia} controls className="w-full rounded-xl" />
                            )}
                            <button onClick={downloadMedia} className="absolute bottom-4 right-4 bg-blue-500 text-white p-3 rounded-full"><Download /></button>
                        </div>
                    )}

                    <canvas ref={canvasRef} style={{ display: 'none' }} />
                </div>
            );
        };

        ReactDOM.render(<CameraApp />, document.getElementById('root'));
    </script>
</body>
</html>
